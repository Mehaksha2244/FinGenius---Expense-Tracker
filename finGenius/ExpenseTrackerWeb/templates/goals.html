{% extends "base.html" %}

{% block title %}ğŸ¯ Goals - Fin Genius{% endblock %}

{% block content %}
<!-- Main Container -->
<div class="main-container">
    <!-- Page Header -->
    <!-- Page Header -->
    <div class="dashboard-header">
        <h1 class="dashboard-title">
            Financial Goals
        </h1>
        <p class="dashboard-subtitle">Set goals, track progress, and celebrate your financial wins! ğŸ†</p>
    </div>

    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
    {% for category, message in messages %}
    <div class="alert alert-{{ 'success' if category == 'success' else 'error' if category == 'error' else 'info' }}">
        {{ message }}
    </div>
    {% endfor %}
    {% endif %}
    {% endwith %}

    <div class="dashboard-grid">
        <!-- Create New Goal -->
        <div class="card" style="grid-column: 1 / -1;">
            <h3
                style="margin-bottom: 1.5rem; color: var(--text-primary); display: flex; align-items: center; gap: 0.5rem;">
                ğŸ¯ Create New Goal
            </h3>

            <form action="{{ url_for('add_goal') }}" method="POST" id="goal-form">
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">ğŸ¯ Goal Title *</label>
                        <input type="text" name="title" class="form-input"
                            placeholder="e.g., Emergency Fund, Vacation, New Laptop" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">ğŸ’° Target Amount *</label>
                        <div style="position: relative;">
                            <span
                                style="position: absolute; left: 1rem; top: 50%; transform: translateY(-50%); color: var(--text-muted); font-weight: 600;">{{
                                currency }}</span>
                            <input type="number" step="0.01" name="target_amount" class="form-input" placeholder="0.00"
                                required style="padding-left: 2.5rem;">
                        </div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">ğŸ“… Deadline (Optional)</label>
                        <input type="date" name="deadline" class="form-input" id="goal-deadline">
                    </div>
                    <div class="form-group">
                        <label class="form-label">ğŸ·ï¸ Category</label>
                        <select name="category" class="form-input">
                            <option value="Emergency Fund">Emergency Fund</option>
                            <option value="Vacation">Vacation</option>
                            <option value="Education">Education</option>
                            <option value="Shopping">Shopping</option>
                            <option value="Investment">Investment</option>
                            <option value="Home">Home</option>
                            <option value="Health">Health</option>
                            <option value="General">General</option>
                        </select>
                    </div>
                </div>

                <button type="submit" class="btn btn-primary btn-lg">
                    ğŸ¯ Create Goal
                </button>
            </form>
        </div>

        <!-- Goals List -->
        <div class="card" style="grid-column: 1 / -1;">
            <h3
                style="margin-bottom: 1.5rem; color: var(--text-primary); display: flex; align-items: center; gap: 0.5rem;">
                ğŸ† Your Goals
            </h3>

            {% if goals %}
            <div id="goals-container">
                {% for goal in goals %}
                <div class="goal-card" data-goal-id="{{ goal.id }}"
                    style="animation: fadeInUp 0.6s ease {{ loop.index0 * 0.1 }}s both;">
                    <div class="goal-header">
                        <div>
                            <h4 class="goal-title">{{ goal.title }}</h4>
                            <div style="color: var(--text-muted); font-size: 0.9rem;">
                                <span
                                    style="background: var(--accent-gradient); color: white; padding: 0.25rem 0.75rem; border-radius: 50px; font-size: 0.8rem; margin-right: 0.5rem;">
                                    {{ goal.category }}
                                </span>
                                {% if goal.deadline %}
                                <span>ğŸ“… Due: {{ goal.deadline }}</span>
                                {% endif %}
                            </div>
                        </div>
                        <div class="goal-amount">
                            {{ currency }}{{ "%.2f"|format(goal.current_amount) }} / {{ currency }}{{
                            "%.2f"|format(goal.target_amount) }}
                        </div>
                    </div>

                    <div class="goal-progress">
                        <div class="progress-container">
                            <div class="progress-bar"
                                style="width: {{ (goal.current_amount / goal.target_amount * 100) if goal.target_amount > 0 else 0 }}%;">
                            </div>
                        </div>
                        <div class="goal-percentage">
                            {{ "%.1f"|format((goal.current_amount / goal.target_amount * 100) if goal.target_amount > 0
                            else 0) }}% Complete
                        </div>
                    </div>

                    <!-- Goal Actions -->
                    <div style="display: flex; gap: 0.5rem; margin-top: 1rem; flex-wrap: wrap;">
                        <form method="POST" action="/goals/{{ goal.id }}/update"
                            style="display: inline-flex; gap: 0.5rem;">
                            <input type="number" step="0.01" name="amount" placeholder="Amount" class="form-input"
                                style="width: 100px; padding: 0.25rem 0.5rem;" required>
                            <button type="submit" class="btn btn-success btn-sm">
                                ğŸ’° Add Money
                            </button>
                        </form>
                        <button class="btn btn-outline btn-sm" onclick="showGoalDetails({{ goal.id }})">
                            ğŸ“Š Details
                        </button>
                        <button class="btn btn-warning btn-sm" onclick="editGoal({{ goal.id }})">
                            âœï¸ Edit
                        </button>
                    </div>

                    <!-- Achievement Badge -->
                    {% if goal.current_amount >= goal.target_amount %}
                    <div
                        style="margin-top: 1rem; padding: 1rem; background: var(--accent-gradient); color: white; border-radius: var(--border-radius-small); text-align: center;">
                        <div style="font-size: 2rem; margin-bottom: 0.5rem;">ğŸ†</div>
                        <h4 style="margin: 0;">Goal Achieved!</h4>
                        <p style="margin: 0.5rem 0 0 0; font-size: 0.9rem;">Congratulations on reaching your target! ğŸ‰
                        </p>
                    </div>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="text-center p-4" style="color: var(--text-muted);">
                <div style="font-size: 3rem; margin-bottom: 1rem;">ğŸ¯</div>
                <h4>No goals yet!</h4>
                <p>Create your first financial goal to start tracking your progress.</p>
            </div>
            {% endif %}
        </div>

        <!-- Achievement Badges -->
        <div class="card">
            <h3 style="margin-bottom: 1rem; color: var(--text-primary);">ğŸ† Achievements</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 1rem;">
                <div
                    style="text-align: center; padding: 1rem; background: var(--bg-glass); border-radius: var(--border-radius-small);">
                    <div style="font-size: 2rem; margin-bottom: 0.5rem;">ğŸ¯</div>
                    <div style="font-size: 0.8rem; color: var(--text-secondary);">First Goal</div>
                </div>
                <div
                    style="text-align: center; padding: 1rem; background: var(--bg-glass); border-radius: var(--border-radius-small);">
                    <div style="font-size: 2rem; margin-bottom: 0.5rem;">ğŸ’°</div>
                    <div style="font-size: 0.8rem; color: var(--text-secondary);">Saver</div>
                </div>
                <div
                    style="text-align: center; padding: 1rem; background: var(--bg-glass); border-radius: var(--border-radius-small);">
                    <div style="font-size: 2rem; margin-bottom: 0.5rem;">ğŸ†</div>
                    <div style="font-size: 0.8rem; color: var(--text-secondary);">Goal Master</div>
                </div>
                <div
                    style="text-align: center; padding: 1rem; background: var(--bg-glass); border-radius: var(--border-radius-small);">
                    <div style="font-size: 2rem; margin-bottom: 0.5rem;">ğŸ’</div>
                    <div style="font-size: 0.8rem; color: var(--text-secondary);">Diamond Saver</div>
                </div>
            </div>
        </div>

        <!-- Progress Statistics -->
        <div class="card">
            <h3 style="margin-bottom: 1rem; color: var(--text-primary);">ğŸ“Š Progress Stats</h3>
            <div style="space-y: 1rem;">
                <div
                    style="display: flex; justify-content: space-between; align-items: center; padding: 1rem; background: var(--bg-glass); border-radius: var(--border-radius-small); margin-bottom: 1rem;">
                    <span style="color: var(--text-primary); font-weight: 500;">Total Goals</span>
                    <span style="color: var(--text-secondary); font-weight: 600;">{{ goals|length }}</span>
                </div>
                <div
                    style="display: flex; justify-content: space-between; align-items: center; padding: 1rem; background: var(--bg-glass); border-radius: var(--border-radius-small); margin-bottom: 1rem;">
                    <span style="color: var(--text-primary); font-weight: 500;">Completed</span>
                    <span style="color: var(--success-color); font-weight: 600;">
                        {% set completed_count = 0 %}
                        {% for goal in goals %}
                        {% if goal.current_amount >= goal.target_amount %}
                        {% set completed_count = completed_count + 1 %}
                        {% endif %}
                        {% endfor %}
                        {{ completed_count }}
                    </span>
                </div>
                <div
                    style="display: flex; justify-content: space-between; align-items: center; padding: 1rem; background: var(--bg-glass); border-radius: var(--border-radius-small); margin-bottom: 1rem;">
                    <span style="color: var(--text-primary); font-weight: 500;">Total Saved</span>
                    <span style="color: var(--text-secondary); font-weight: 600;">
                        {{ currency }}{{ "%.2f"|format(goals|sum(attribute='current_amount')) }}
                    </span>
                </div>
                <div
                    style="display: flex; justify-content: space-between; align-items: center; padding: 1rem; background: var(--bg-glass); border-radius: var(--border-radius-small);">
                    <span style="color: var(--text-primary); font-weight: 500;">Target Total</span>
                    <span style="color: var(--text-secondary); font-weight: 600;">
                        {{ currency }}{{ "%.2f"|format(goals|sum(attribute='target_amount')) }}
                    </span>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Initialize goals page
    document.addEventListener('DOMContentLoaded', function () {
        initializeGoalsPage();
    });

    function initializeGoalsPage() {
        // Set default deadline to 3 months from now
        const deadlineInput = document.getElementById('goal-deadline');
        if (deadlineInput) {
            const futureDate = new Date();
            futureDate.setMonth(futureDate.getMonth() + 3);
            deadlineInput.value = futureDate.toISOString().split('T')[0];
        }

        // Animate progress bars
        animateProgressBars();

        // Add goal form validation
        const goalForm = document.getElementById('goal-form');
        if (goalForm) {
            goalForm.addEventListener('submit', function (e) {
                const targetAmount = parseFloat(document.querySelector('input[name="target_amount"]').value);
                if (isNaN(targetAmount) || targetAmount <= 0) {
                    e.preventDefault();
                    if (typeof showNotification === 'function') {
                        showNotification('Please enter a valid target amount! ğŸ’°', 'error');
                    } else {
                        alert('Please enter a valid target amount! ğŸ’°');
                    }
                    return;
                }
            });
        }
    }

    function animateProgressBars() {
        const progressBars = document.querySelectorAll('.progress-bar');
        progressBars.forEach((bar, index) => {
            const width = bar.style.width;
            // Animate from 0 to width
            bar.style.width = '0%';
            setTimeout(() => {
                bar.style.width = width;
            }, index * 200 + 100);
        });
    }

    function showGoalDetails(goalId) {
        if (typeof showNotification === 'function') {
            showNotification('Goal details feature coming soon! ğŸ“Š', 'info');
        }
    }

    function editGoal(goalId) {
        if (typeof showNotification === 'function') {
            showNotification('Edit goal feature coming soon! âœï¸', 'info');
        }
    }
</script>
{% endblock %}